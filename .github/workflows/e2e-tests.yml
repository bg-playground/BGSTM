jobs:
  e2e:
    steps:
      - name: Wait for backend to be healthy
        run: |
          for i in {1..10}; do
            response=$(curl -s -o /dev/null -w "%{http_code}" http://backend:8000/health);
            if [ "$response" -eq 200 ]; then
              echo "Backend is healthy, exiting successfully."
              exit 0;
            fi;
            echo "Backend is unhealthy, retrying..."
            sleep 10;
          done;

          echo "Backend is still unhealthy after retries."
          echo "Diagnostic output:";
          echo "Docker Compose PS:";
          docker compose ps;
          echo "Backend Logs:";
          docker logs <backend_container_name>;
          echo "DB Logs:";
          docker logs <db_container_name>;

          exit 1;
      
      # Other steps...
